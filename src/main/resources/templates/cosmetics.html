<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="us">

<head>
    <th:block th:replace="fragments/head :: commonHeader" />

    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
    <title></title>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div style="margin: 50px 200px 200px;">
    <br>
    <h1>Cosmetics List</h1>
    <hr>
    <div>
        <style>
            form.search-form {
                margin-bottom: 25px; /* space below first form */
            }
        </style>
        <form class="search-form" th:action="@{/cosmetics.html}" method="get">

            <datalist id="sortByOptions">
                <option value="productName" label="Name"></option>
                <option value="primaryBarcode" label="SKU"></option>
                <option value="categories" label="Category"></option>
                <option value="inStockQuantity" label="Quantity"></option>
                <option value="vbrp" label="Price"></option>
            </datalist>
<!--            <br>-->
        </form>
        <div>
            <form class="second-form" th:action="@{/api/products/searchCosmetics}" method="get">
                <div>
<!--                    <input type="hidden" name="pageNumber" value="0" />-->
<!--                    <input type="hidden" name="pageSize" value="50">-->
                    <label for="keyword">Search Product</label>
                    <input
                            type="search"
                            id="keyword"
                            name="keyword"
                            th:value="${keyword}"
                            placeholder="Search By Keywordâ€¦"
                            required
                    />
<!--                    <label for="sortByKeyword">Sort By</label>-->
<!--                    <input type="text" list="sortByOptions" name="sortBy" id="sortByKeyword" th:value="${sortBy}" placeholder="Sort...">-->
                    <button type="submit">Search</button>
                    <span class="validity" aria-live="polite"></span>
                    <a th:href="@{/api/products/searchCosmetics}" class="btn btn-secondary btn-sm">Clear / Show All</a>
                </div>
            </form>
        </div>
        <style>
            form.second-form {
                margin-top: 15px; /* space above second form */
            }
        </style>

        <!-- Pagination Navigation aligned with forms -->
        <div th:if="${totalPages != null and totalPages > 0}" style="margin-top: 15px;">
            <!-- Page Info -->
            <p style="margin: 10px 0; font-size: 16px; color: #333;">
                <strong>Page <span th:text="${currentPage + 1}">1</span> of <span th:text="${totalPages}">1</span></strong>
                <span style="color: #666;"> | Total: <span th:text="${totalElements}">0</span> products</span>
            </p>

            <!-- Bootstrap Pagination Navigation with Limited Pages -->
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <!-- Previous Button -->
                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/api/products/searchCosmetics(pageNumber=${currentPage > 0 ? currentPage - 1 : 0}, pageSize=${pageSize}, sortBy=${sortBy}, sortOrder=${sortOrder}, keyword=${keyword})}"
                           tabindex="-1"
                           th:attr="aria-disabled=${currentPage == 0}">
                            Previous
                        </a>
                    </li>

                    <!-- First Page -->
                    <li class="page-item" th:if="${currentPage > 2}">
                        <a class="page-link"
                           th:href="@{/api/products/searchCosmetics(pageNumber=0, pageSize=${pageSize}, sortBy=${sortBy}, sortOrder=${sortOrder}, keyword=${keyword})}">
                            1
                        </a>
                    </li>

                    <!-- Ellipsis if needed -->
                    <li class="page-item disabled" th:if="${currentPage > 3}">
                        <span class="page-link">...</span>
                    </li>

                    <!-- Page Numbers (show 2 before, current, 2 after) -->
                    <th:block th:with="startPage=${currentPage > 2 ? currentPage - 2 : 0},
                               endPage=${currentPage + 2 < totalPages - 1 ? currentPage + 2 : totalPages - 1}">
                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(startPage, endPage)}"
                            th:classappend="${i == currentPage} ? 'active'">
                            <a class="page-link"
                               th:href="@{/api/products/searchCosmetics(pageNumber=${i}, pageSize=${pageSize}, sortBy=${sortBy}, sortOrder=${sortOrder}, keyword=${keyword})}"
                               th:text="${i + 1}">1</a>
                        </li>
                    </th:block>

                    <!-- Ellipsis if needed -->
                    <li class="page-item disabled" th:if="${currentPage + 3 < totalPages - 1}">
                        <span class="page-link">...</span>
                    </li>

                    <!-- Last Page -->
                    <li class="page-item" th:if="${currentPage + 2 < totalPages - 1}">
                        <a class="page-link"
                           th:href="@{/api/products/searchCosmetics(pageNumber=${totalPages - 1}, pageSize=${pageSize}, sortBy=${sortBy}, sortOrder=${sortOrder}, keyword=${keyword})}"
                           th:text="${totalPages}">
                            Last
                        </a>
                    </li>

                    <!-- Next Button -->
                    <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/api/products/searchCosmetics(pageNumber=${currentPage + 1 >= totalPages ? totalPages - 1 : currentPage + 1}, pageSize=${pageSize}, sortBy=${sortBy}, sortOrder=${sortOrder}, keyword=${keyword})}">
                            Next
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <br>
    <div>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Name</th>
                <th>SKU</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Actions</th>
                <a th:href="@{/new}" class="btn btn-primary" title="Add">
                    Add
                </a>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product : ${productDTOList}">
                <td th:text="${product.productName}">Product Name</td>
                <td th:text="${product.primaryBarcode}">SKU123</td>
                <td th:text="${product.categories}">Category</td>
                <td th:text="${product.inStockQuantity}">0</td>
                <td th:text="'$' + ${product.getVbrp}">$0.00</td>
                <td>
                    <div class="action-buttons">
                        <a th:href="@{'/edit/' + ${product.id}}" class="btn-circle-edit" title="Edit">
                            &#9998;
                        </a>
                        <form th:action="@{'/delete/' + ${product.id}}" method="post"
                              onsubmit="return confirm('Are you sure you want to delete this product?  This action cannot be undone.');">
                            <button type="submit" class="btn-circle-delete" title="Delete">
                                &#128465;
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <div th:if="${currentPage != null and totalPages != null}">
            <p style="margin: 10px 0; font-size: 16px; color: #333;">
                <strong>Page <span th:text="${currentPage + 1}">1</span> of <span th:text="${totalPages}">1</span></strong>
                <span style="color: #666;"> | Total: <span th:text="${totalElements}">0</span> products</span>
            </p>
        </div>
    </div>
</div>
<div th:insert="fragments/footer :: inventory-footer"></div>
</body>
</html>